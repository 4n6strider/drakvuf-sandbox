#!/bin/bash
set -e

if [ "$EUID" -ne 0 ]
then
  echo "This script should be ran as root."
  exit 1
fi

rm -rf /tmp/iptbuild
mkdir /tmp/iptbuild
cd /tmp/iptbuild

git clone https://github.com/icedevml/libipt.git
git clone https://github.com/intelxed/xed.git
git clone https://github.com/intelxed/mbuild.git

cd xed
./mfile.py --share
./mfile.py --prefix=/usr/local install
ldconfig

cd ../libipt
git checkout
cmake -D PTDUMP=On -D PTXED=On .
make install
